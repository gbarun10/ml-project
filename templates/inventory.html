{% extends 'base.html' %}
{% block content %}
  <h2>Inventory Management</h2>
  
  <div class="mb-3">
    <a class="btn btn-primary" href="/admin">Back to Admin Dashboard</a>
  </div>
  
  <h4>Reorder Suggestions</h4>
  {% if rows and rows|length > 0 %}
    <div class="table-responsive mb-4">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Item</th>
            <th>Predicted Demand (7d)</th>
            <th>Current Stock</th>
            <th>Reorder Flag</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r['Item'] }}</td>
            <td>{{ '%.2f'|format(r['Predicted_Demand']) if r['Predicted_Demand'] is not none else '' }}</td>
            <td>{{ r['Current_Stock'] }}</td>
            <td>
              {% if r.get('Reorder_Flag', False) %}
                <span class="badge bg-danger">Reorder Needed</span>
              {% else %}
                <span class="badge bg-success">OK</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>No items require reordering right now.</p>
  {% endif %}
  
  <h4>Product Stock & Recent Sales (Last 7 Days)</h4>
  {% if products and products|length > 0 %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Product</th>
            <th>Current Stock</th>
            <th>Recent Sales (7d)</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr>
            <td>{{ p['name'] }}</td>
            <td>{{ p['stock'] }}</td>
            <td>{{ p.get('recent_sales', 0) }}</td>
            <td>
              {% if p['stock'] <= 0 %}
                <span class="badge bg-danger">Out of Stock</span>
              {% elif p['stock'] <= 5 %}
                <span class="badge bg-warning">Low Stock</span>
              {% else %}
                <span class="badge bg-success">In Stock</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>No products found.</p>
  {% endif %}
{% endblock %}


